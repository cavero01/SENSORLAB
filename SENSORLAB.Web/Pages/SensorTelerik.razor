@page "/sensorTelerik"

<PageTitle>SENSOR</PageTitle>

@inject Sensor2Services SensorService2

<h1>SENSORES</h1>

<p>SENSORES</p>

<TelerikGrid Data="@sensors"
             EditMode="@GridEditMode.Popup"
             
             Pageable="true"
             Sortable="true"
             OnCreate="@CreateHandler"
             OnDelete="@DeleteHandler"
             OnUpdate="@UpdateHandler" 
             
             FilterMode="@GridFilterMode.FilterRow">
    <GridToolBar>
        <GridCommandButton Command="Add" Icon="add">Add Sensor</GridCommandButton>
    </GridToolBar>
    <GridColumns>
        <GridColumn Field="idSensor" Title="Identificacion" />
        <GridColumn Field="fabricante" />    
        <GridCommandColumn>
            <GridCommandButton Command="Save" Icon="save" ShowInEdit="true">Crear</GridCommandButton>
            <GridCommandButton Command="Delete" Icon="delete">Delete</GridCommandButton>
            <GridCommandButton Command="Cancel" Icon="cancel" ShowInEdit="true">Cancel</GridCommandButton>
            <GridCommandButton Command="Edit" Icon="edit">Edit</GridCommandButton>
        </GridCommandColumn>
    </GridColumns>
</TelerikGrid>

@code {
    
    private List<Sensor> sensors = new();

    protected override async Task OnInitializedAsync()
    {     
        sensors  = await SensorService2. GetSensorAsync();
    }

    async Task CreateHandler(GridCommandEventArgs args)
    {
        Sensor item = (Sensor)args.Item;

        await SensorService2.PostSensorAsync(item);

        sensors  = await SensorService2. GetSensorAsync();

    }
    async Task DeleteHandler(GridCommandEventArgs args)
    {
        Sensor item = (Sensor)args.Item;

        await SensorService2.DeleteSensorAsync(item.idSensor);
        //linea para actualizar la grlla de telerik
       sensors  = await SensorService2. GetSensorAsync();
    }
     async Task UpdateHandler(GridCommandEventArgs args)
    {
        Sensor item = (Sensor)args.Item;

        await SensorService2.UpdateSensorAsync(item.idSensor,item);
         //linea para actualizar la grlla de telerik
       sensors  = await SensorService2. GetSensorAsync();
    }
}
